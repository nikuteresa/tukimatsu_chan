# 月末自動通知ツール 要件定義書

## 1. 通知内容と目的
決定事項：
- メールを送信する
- 本文には「月末です」という内容を含める

## 2. 通知方法
決定事項：
- 送信元メールアドレス: no-reply.me@no.reply のような形式
- 送信先メールアドレス: 設定ファイルから読み込む（配列対応）
- 件名: 日付を含めた動的な件名 (例: "2025年4月の月末のお知らせ")
- 将来的にSlack通知も追加予定

## 3. 通知タイミング
決定事項：
- 月の最終営業日に通知
- 通知時間は18時をデフォルトとするが、設定で変更可能にする
- 頻度：毎月の最終営業日に1回

## 4. 通知対象者
決定事項：
- 一旦個人用として実装
- 送信先メールアドレスは配列で複数対応できるように実装

## 5. サーバー/インフラ
決定事項：
- GitHub Actionsを使用
- 定期的なワークフローとして実行
- コード管理と一元化できる利点あり

## 6. データ保存
決定事項：
- 設定形式: YAMLファイル
- 通知履歴: JSONフォーマットのログファイルに記録

## 7. 認証/セキュリティ
決定事項：
- メール送信サービス: GitHub Actionsマーケットプレイスの「dawidd6/action-send-mail」アクションを利用
- 認証情報: GitHub Secretsに保存

## 8. 拡張性
決定事項：
- Slack通知の追加を想定した設計にする
- 通知メソッドを抽象化して、将来的に他のチャネルを追加できるようにする

## 9. メンテナンス計画
決定事項：
- エラー通知: GitHub Actionsのデフォルト通知を利用（追加の通知は不要）
- ログ形式: JSON形式
- ログの保存場所: GitHubリポジトリ内

## 10. 技術スタック
- 言語: Ruby
- プラットフォーム: GitHub Actions
- 設定ファイル: YAML
- ログ形式: JSON

## 11. プロジェクト制約
- 無料で運用可能であること
- 最小限の実装から始め、必要に応じて機能拡張する

## 12. クラス構造

リファクタリングにより、以下のクラス構造に整理されました：

- **Application**: アプリケーション全体を制御するクラス
- **BusinessDayCalculator**: 営業日の計算を行うクラス
- **ConfigManager**: 設定ファイルの読み込みと管理を行うクラス
- **Logger**: ログの記録を行うクラス
- **Notifier**: 通知メッセージの生成を行うクラス

### クラスの責務

- **Application**
  - アプリケーション全体のフロー制御
  - 他のクラスのインスタンス管理

- **BusinessDayCalculator**
  - 営業日（土日・祝日を除く日）の判定
  - 月末最終営業日の判定

- **ConfigManager**
  - 設定ファイルの読み込み
  - デフォルト設定の管理
  - 設定値へのアクセス方法の提供

- **Logger**
  - 通知履歴のログ記録
  - ログファイルの管理

- **Notifier**
  - 通知メッセージの生成
  - 環境変数用の出力生成

## 13. 使用方法

```bash
# 依存パッケージのインストール
$ bundle install

# 手動実行
$ ruby main.rb
```

GitHub Actionsでの自動実行は、毎日JST 18:00に行われます。
